version: '2'

services:
  rabbit:
    hostname: rabbitmq
    image: rabbitmq:latest
    environment:
      - RABBITMQ_DEFAULT_USER=admin
      - RABBITMQ_DEFAULT_PASS=admin
      - RABBITMQ_DEFAULT_VHOST=grass
    ports:
      - "5672:5672"

  worker:
    build:
      context: .
    environment:
      - PIKA_SCRAPPER_USERNAME=admin
      - PIKA_SCRAPPER_PASSWORD=admin
      - PIKA_TMDB_API_KEY=${PIKA_TMDB_API_KEY}
      - GRASS_DB=postgres
    volumes:
      - ./src:/grass/src
    links:
      - rabbit
    depends_on:
      - rabbit
    ports:
    - "5555:5555"

volumes:
  grass_postgres_data:
